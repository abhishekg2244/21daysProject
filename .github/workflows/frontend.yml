name: frontend

on:
  # push:
  #   branches: ["main"]
  workflow_dispatch:

    
jobs:
  CI:
    name: CI
    runs-on: self-hosted

    defaults:
        run:
          working-directory: ./application/frontend/

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Login to GHCR
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Login to GHCR
        run: echo "${{ secrets.GITHUB_TOKEN }}" | docker login ghcr.io -u abhishekg2244 --password-stdin

      - name: Build Image
        run: docker build -t ghcr.io/abhishekg2244/21daysproject-frontend:latest .
                             
      - name: Push
        run: docker push ghcr.io/abhishekg2244/21daysproject-frontend:latest

  # deploy:
  #   needs: build-push
  #   runs-on: ubuntu-latest

  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v4

  #     - name: Set kubeconfig
  #       run: |
  #         mkdir -p ~/.kube
  #         echo "${{ secrets.MINIKUBE_KUBECONFIG }}" > ~/.kube/config

  #     - name: Deploy to Minikube
  #       run: |
  #         kubectl set image deployment/todo-deployment todo-app=ghcr.io/${{ github.repository_owner }}/todo-app:latest
